{% extends 'layoutAdmin.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/filterDashboard.css') }}">
    <link rel="stylesheet" href="{{ asset('css/tableDashboard.css') }}">
{% endblock %}

{% block admin_content %}
{# {{ dump(occurrences) }} #}


<section class="content" data-page="OCORRÊNCIAS ENCERRADAS">
    <!-- Filtros de Pesquisa -->
    <div class="filter-box collapse" id="filterSection">
        <div class="filter-content filter-controls occurrence-controls">
            <div class="row mb-4">
                <div class="col-md-4">
                    <label for="typeFilter">Tipo:</label>
                    <select id="typeFilter" class="form-control">
                        <option value="">Todos</option>
                        <option value="tipo1">Tipo 1</option>
                        <option value="tipo2">Tipo 2</option>
                        <option value="tipo3">Tipo 3</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="responsibleFilter">Responsável:</label>
                    <select id="responsibleFilter" class="form-control">
                        <option value="">Todos</option>
                        <option value="responsavel1">Responsável 1</option>
                        <option value="responsavel2">Responsável 2</option>
                        <option value="responsavel3">Responsável 3</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <label for="occurredDateFilter">Data de Ocorrência:</label>
                    <input type="date" id="startOccurredDate" class="form-control mb-2" placeholder="Data Inicial">
                    <input type="date" id="endOccurredDate" class="form-control" placeholder="Data Final">
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <!-- Botão de Filtros -->
        <div class="row mb-4">
            <div class="col-md-4">
                <input type="text" id="occurrenceSearch" class="form-control" placeholder="Pesquisar..." aria-controls="occurrencesTable">
            </div>
            <div class="col-md-4 text-left">
                <button class="btn btn-dark" type="button" data-toggle="collapse" data-target="#filterSection" aria-expanded="false" aria-controls="filterSection">
                    <i class="fas fa-filter fa-chevron-down"></i>
                </button>
            </div>
            <div class="col-md-4 text-right">
                <a href="{{ path('occurrences_dashboard') }}" class="btn btn-dark">
                    Ocorrências Abertas
                </a>
            </div>
        </div>

        <!-- Tabela de Ocorrências -->
        <div class="table-responsive tableOccurrenceContainer">
            <table id="occurrencesTable" class="table table-striped table-bordered" style="width:100%">
                <thead>
                    <tr>
                    <!-- Adicionado via javascript -->
                    </tr>
                </thead>
                <tbody>
                    <!-- Adicionado via javascript -->
                </tbody>
            </table>
        </div>
    </div>
</section>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
    var occurrencesTable;
    var occurrencesTableData = [
        {
            id: 1,
            occurrenceCode: "CAN012024",
            title: "Ocorrência Teste 1",
            status: "Aberta",
            occurrenceDate: "2024-01-01 12:00",
            occurrenceType: "Tipo 1",
            responsible: "Responsável 1",
            lastUpdate: "2024-01-01 12:30"
        },
        {
            id: 2,
            occurrenceCode: "CAN022024",
            title: "Ocorrência Teste 2",
            status: "Em Progresso",
            occurrenceDate: "2024-02-01 12:00",
            occurrenceType: "Tipo 2",
            responsible: "Responsável 2",
            lastUpdate: "2024-02-01 12:30"
        },
        {
            id: 3,
            occurrenceCode: "CAN032024",
            title: "Ocorrência Teste 3",
            status: "Concluído",
            occurrenceDate: "2024-03-01 12:00",
            occurrenceType: "Tipo 3",
            responsible: "Responsável 3",
            lastUpdate: "2024-03-01 12:30"
        },
         {
            id: 3,
            occurrenceCode: "CAN032024",
            title: "Ocorrência Teste 3",
            status: "Concluído",
            occurrenceDate: "2024-03-01 12:00",
            occurrenceType: "Tipo 3",
            responsible: "Responsável 3",
            lastUpdate: "2024-03-01 12:30"
        },
         {
            id: 3,
            occurrenceCode: "CAN032024",
            title: "Ocorrência Teste 3",
            status: "Concluído",
            occurrenceDate: "2024-03-01 12:00",
            occurrenceType: "Tipo 3",
            responsible: "Responsável 3",
            lastUpdate: "2024-03-01 12:30"
        },
         {
            id: 3,
            occurrenceCode: "CAN032024",
            title: "Ocorrência Teste 3",
            status: "Concluído",
            occurrenceDate: "2024-03-01 12:00",
            occurrenceType: "Tipo 3",
            responsible: "Responsável 3",
            lastUpdate: "2024-03-01 12:30"
        },
         {
            id: 3,
            occurrenceCode: "CAN032024",
            title: "Ocorrência Teste 3",
            status: "Concluído",
            occurrenceDate: "2024-03-01 12:00",
            occurrenceType: "Tipo 3",
            responsible: "Responsável 3",
            lastUpdate: "2024-03-01 12:30"
        },
         {
            id: 3,
            occurrenceCode: "CAN032024",
            title: "Ocorrência Teste 3",
            status: "Concluído",
            occurrenceDate: "2024-03-01 12:00",
            occurrenceType: "Tipo 3",
            responsible: "Responsável 3",
            lastUpdate: "2024-03-01 12:30"
        },
         {
            id: 3,
            occurrenceCode: "CAN032024",
            title: "Ocorrência Teste 3",
            status: "Concluído",
            occurrenceDate: "2024-03-01 12:00",
            occurrenceType: "Tipo 3",
            responsible: "Responsável 3",
            lastUpdate: "2024-03-01 12:30"
        },
         {
            id: 3,
            occurrenceCode: "CAN032024",
            title: "Ocorrência Teste 3",
            status: "Concluído",
            occurrenceDate: "2024-03-01 12:00",
            occurrenceType: "Tipo 3",
            responsible: "Responsável 3",
            lastUpdate: "2024-03-01 12:30"
        },
         {
            id: 3,
            occurrenceCode: "CAN032024",
            title: "Ocorrência Teste 3",
            status: "Concluído",
            occurrenceDate: "2024-03-01 12:00",
            occurrenceType: "Tipo 3",
            responsible: "Responsável 3",
            lastUpdate: "2024-03-01 12:30"
        },
         {
            id: 3,
            occurrenceCode: "CAN032024",
            title: "Ocorrência Teste 3",
            status: "Concluído",
            occurrenceDate: "2024-03-01 12:00",
            occurrenceType: "Tipo 3",
            responsible: "Responsável 3",
            lastUpdate: "2024-03-01 12:30"
        },
         {
            id: 3,
            occurrenceCode: "CAN032024",
            title: "Ocorrência Teste 3",
            status: "Concluído",
            occurrenceDate: "2024-03-01 12:00",
            occurrenceType: "Tipo 3",
            responsible: "Responsável 3",
            lastUpdate: "2024-03-01 12:30"
        },
         {
            id: 3,
            occurrenceCode: "CAN032024",
            title: "Ocorrência Teste 3",
            status: "Concluído",
            occurrenceDate: "2024-03-01 12:00",
            occurrenceType: "Tipo 3",
            responsible: "Responsável 3",
            lastUpdate: "2024-03-01 12:30"
        },
         {
            id: 3,
            occurrenceCode: "CAN032024",
            title: "Ocorrência Teste 3",
            status: "Concluído",
            occurrenceDate: "2024-03-01 12:00",
            occurrenceType: "Tipo 3",
            responsible: "Responsável 3",
            lastUpdate: "2024-03-01 12:30"
        },
        {
            id: 3,
            occurrenceCode: "CAN032024",
            title: "Ocorrência Teste 3",
            status: "Concluído",
            occurrenceDate: "2024-03-01 12:00",
            occurrenceType: "Tipo 3",
            responsible: "Responsável 3",
            lastUpdate: "2024-03-01 12:30"
        },
        {
            id: 3,
            occurrenceCode: "CAN032024",
            title: "Ocorrência Teste 3",
            status: "Concluído",
            occurrenceDate: "2024-03-01 12:00",
            occurrenceType: "Tipo 3",
            responsible: "Responsável 3",
            lastUpdate: "2024-03-01 12:30"
        },
        {
            id: 3,
            occurrenceCode: "CAN032024",
            title: "Ocorrência Teste 3",
            status: "Concluído",
            occurrenceDate: "2024-03-01 12:00",
            occurrenceType: "Tipo 3",
            responsible: "Responsável 3",
            lastUpdate: "2024-03-01 12:30"
        },
        {
            id: 3,
            occurrenceCode: "CAN032024",
            title: "Ocorrência Teste 3",
            status: "Concluído",
            occurrenceDate: "2024-03-01 12:00",
            occurrenceType: "Tipo 3",
            responsible: "Responsável 3",
            lastUpdate: "2024-03-01 12:30"
        },
        {
            id: 3,
            occurrenceCode: "CAN032024",
            title: "Ocorrência Teste 3",
            status: "Concluído",
            occurrenceDate: "2024-03-01 12:00",
            occurrenceType: "Tipo 3",
            responsible: "Responsável 3",
            lastUpdate: "2024-03-01 12:30"
        }
    ];

function setupOccurrencesDataTable() {
    if ($.fn.DataTable.isDataTable('#occurrencesTable')) {
        $('#occurrencesTable').DataTable().clear().destroy();
    }

    occurrencesTable = $('#occurrencesTable').DataTable({
        searching: true,
        paging: false,
        info: false,
        data: occurrencesTableData,
        columns: [
            { data: 'id', title: 'ID', visible: false },
            { data: 'occurrenceCode', title: 'Código' },
            { data: 'title', title: 'Título' },
            { data: 'status', title: 'Status' },
            { data: 'occurrenceDate', title: 'Data da Ocorrência' },
            { data: 'occurrenceType', title: 'Tipo' },
            { data: 'responsible', title: 'Responsável' },
            { data: 'lastUpdate', title: 'Última Atualização' },
            { title: 'Ações' }
        ],
        columnDefs: [
            {
                targets: -1, // Última coluna (Ações)
                render: function (data, type, row, meta) {
                    var occurrencesId = row.id; 
                    return `
                        <button class="btn-action occurrences-view" title="Visualizar" data-occurrences-id="${occurrencesId}"><i class="fa fa-eye"></i></button>
                        <button class="btn-action occurrences-pdf" title="Exportar Pdf" data-occurrences-id="${occurrencesId}"><i class="fa fa-file-pdf"></i></button>
                        <button class="btn-action occurrences-open" title="Reabrir ocorrência" data-occurrences-id="${occurrencesId}"><i class="fa fa-unlock"></i></button>
                    `;
                }
            }
        ],
        lengthChange: false,
        ordering: true,
        dom: 'lrtip',
        scrollX: true,
        fixedHeader: true,
        language: {
            zeroRecords: "Nenhum registro correspondente encontrado",
            emptyTable: "Nenhum dado disponível na tabela"
        }
    });

    adjustTable();
}

function adjustTable() {
    setTimeout(function() {
        occurrencesTable.columns.adjust().draw();
    }, 100);
}

    $(document).ready(function() {
        // Inicialização do DataTables
        setupOccurrencesDataTable();

        // Filtro de pesquisa personalizado
        $('#occurrenceSearch').on('keyup', function() {
            occurrencesTable.search(this.value).draw();
        });

        // Exibição dos filtros ao clicar no botão
        $('#filterSection').on('shown.bs.collapse', function () {
            $('.btn-filter').addClass('active'); // Adiciona classe de destaque ao botão de filtro
            $('.filter-box').slideDown(); // Animação de slide para exibir os filtros
        });

        // Ocultação dos filtros ao fechar o modal
        $('#filterSection').on('hidden.bs.collapse', function () {
            $('.btn-filter').removeClass('active'); // Remove classe de destaque ao fechar os filtros
            $('.filter-box').slideUp(); // Animação de slide para ocultar os filtros
        });
    });
</script>
{% endblock %}
